---
import BaseLayout from "@web/layout/BaseLayout/BaseLayout.astro";
import PostLayout from "@web/layout/PostLayout/PostLayout.astro";
import {
  type Post,
  fetchPosts,
  formatTitle,
  formatAuthor,
  formatDate,
  formatCategories,
  formatImage,
  formatContent,
} from "@/data-access/wordpress";

// ðŸ§° Config
export const prerender = false;

const { slug } = Astro.params;
const article: Post = (await fetchPosts({ slug }, [
  "title",
  "slug",
  "author",
  "date",
  "categories",
  "image",
  "content",
])) as Post;

if (!article) return Astro.rewrite("/404");

// This will cache the content of any page for 5 minutes in user browser and 1 week in CDN (every page is invalidated on every deploy)
Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=300, s-maxage=31536000",
);
---

<PostLayout
  title={formatTitle(article)}
  author={formatAuthor(article)}
  date={formatDate(article, { explicit: false })}
  categories={formatCategories(article)}
  image={formatImage(article)}>
  <Fragment
    slot="content"
    set:html={formatContent(article)}
  />
</PostLayout>
