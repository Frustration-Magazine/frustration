---
import PageLayout from "@/layout/PageLayout/PageLayout.astro";
import H2 from "@/components/H2";
import H3 from "@/components/H3";
import { EventsTabs } from "./_components/EventsTabs";

import { prisma } from "data-access/prisma";
import { OG_IMAGES_URL } from "@/constants";
import { setCacheHeaders, CachePresets } from "@/lib/cache";

export const prerender = false;
setCacheHeaders(Astro.response.headers, CachePresets.medium);

const events = await prisma.events.findMany({
  include: {
    image: true,
  },
  where: { displayEvent: true },
  orderBy: {},
});

export type EventWithImage = (typeof events)[number];

const futureEvents = events
  .filter(({ date }) => date >= new Date())
  .sort((a, b) => a.date.getTime() - b.date.getTime());
const pastEvents = events.filter(({ date }) => date < new Date()).sort((a, b) => b.date.getTime() - a.date.getTime());
---

<PageLayout
  title="Événements"
  description="Liste des événements à venir autour de Frustration Magazine et Nicolas Framont"
  ogImageUrl={`${OG_IMAGES_URL}/evenements.webp`}
>
  <article slot="content">
    <H2>Frustra'tour</H2>
    <H3 className="mb-8 text-center"
      >Venez rencontrer l'équipe de Frustration Magazine lors de nos événements publics !</H3
    >

    <EventsTabs
      client:load
      futureEvents={futureEvents}
      pastEvents={pastEvents}
    />
  </article>
</PageLayout>
