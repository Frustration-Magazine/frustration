---
import { Image } from "astro:assets";
import { TbSend } from "react-icons/tb";

const currentYear = new Date().getFullYear();

// üì¶ Data

const loadNetworkIcon = async (iconName: string) =>
  (await import(`./icons/${iconName}.svg`)).default;
const networks = [
  {
    name: "Twitter",
    url: "https://twitter.com/Frustration_web",
    iconName: await loadNetworkIcon("X"),
  },
  {
    name: "Facebook",
    url: "https://www.facebook.com/FrustrationMag",
    iconName: await loadNetworkIcon("facebook"),
  },
  {
    name: "Youtube",
    url: "https://www.youtube.com/channel/UCHCwlzgXqqjrNxfVOmLsU5w",
    iconName: await loadNetworkIcon("youtube"),
  },
  {
    name: "TikTok",
    url: "https://www.tiktok.com/@frustrationmag",
    iconName: await loadNetworkIcon("tiktok"),
  },
  {
    name: "Instagram",
    url: "https://www.instagram.com/frustrationmag/",
    iconName: await loadNetworkIcon("instagram"),
  },
  {
    name: "Flux RSS",
    url: "https://www.frustrationmagazine.fr/feed",
    iconName: await loadNetworkIcon("rss"),
  },
];

const credits = [
  {
    name: "Farton Bink",
    role: "Montage vid√©o",
  },
  {
    name: "Antoine Glorieux",
    role: "Illustrations",
  },
  {
    name: "Thibaut Izard",
    role: "D√©veloppement web",
  },
];

const links = [
  {
    name: "Mentions l√©gales",
    url: "/mentions-legales",
  },
  {
    name: "Politique de confidentialit√©",
    url: "/politique-de-confidentialite",
  },
];
---

<footer class="bg-yellow-with-tiles pt-10">
  <div
    class="m-auto flex max-w-[1700px] flex-wrap justify-between gap-10 px-6 py-12 lg:px-20 lg:py-20">
    <!-- üî† Titles -->
    <div class="w-full text-center sm:text-left">
      <h2
        class="font-bebas text-6xl sm:mb-0 sm:text-7xl font-bold uppercase leading-[80%]">
        Frustration Magazine
      </h2>
      <h4 class="font-bakbak text-2xl -mt-2 mb-2 uppercase leading-none">
        Le m√©dia de la lutte des classes
      </h4>
      <p class="font-open-sans text-sm">
        ¬© Frustration Magazine ‚Äì {currentYear}
      </p>
    </div>
    <!-- üì§ Newsletter -->
    <div class="mt-3 flex flex-grow basis-[47%] flex-col">
      <h5 class="mb-1 font-bakbak text-3xl leading-[80%]">
        Nous suivre <span
          class="hidden font-open-sans italic text-sm ml-0.5 xs:inline-block"
          >(jusqu'√† la r√©volution !)</span
        >
      </h5>
      <p class="mb-6 font-open-sans leading-tight">
        Recevez r√©guli√®rement une s√©lection de nos meilleurs articles r√©cemment
        parus !
      </p>
      <form
        data-form="newsletter-footer"
        class="flex flex-col gap-3">
        <input
          class="px-5 py-2"
          required
          name="email"
          placeholder="Email"
          type="email"
        />
        <button
          type="submit"
          class="bg-black py-2 font-open-sans text-base justify-center font-bold text-yellow flex items-center gap-2">
          <TbSend />
          <span>S'inscrire √† la newsletter</span>
        </button>
      </form>
      <script>
        import { actions } from "astro:actions";
        const form = document.querySelector(
          "[data-form=newsletter-footer]",
        ) as HTMLFormElement;
        if (form) {
          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const { error } = await actions.addSubscriber(formData);
            if (error)
              console.error("error while creating a new subscriber contact", e);
            if (!error) {
              const input = form.querySelector(
                "input[type=email]",
              ) as HTMLInputElement;

              const submitButton = form.querySelector(
                "button[type=submit]",
              ) as HTMLButtonElement;

              // Hide input
              input.disabled = true;
              input.placeholder = "";

              // Change submit button style
              submitButton.disabled = true;
              submitButton.style.backgroundImage = "none";
              submitButton.textContent =
                "Vous √™tes bien inscrit.e √† notre newsletter !";

              // Reset form
              form.reset();
            }
          });
        }
      </script>
    </div>
    <!-- üì∏ Social medias -->
    <div
      class="mt-10 flex min-h-[100px] flex-grow basis-[47%] flex-col justify-between">
      <div class="">
        <h5 class="mb-3 font-bakbak text-3xl leading-[80%]">
          Nos r√©seaux sociaux
        </h5>
        <ul class="flex items-center gap-3">
          {
            networks.map(({ name, url, iconName }) => (
              <li>
                <a
                  aria-label={name}
                  href={url}
                  target="_blank">
                  <Image
                    src={iconName}
                    width="25"
                    height="25"
                    alt={name}
                    title={`Acc√©der √† notre ${name}`}
                  />
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <!-- üëè Credits -->
      <div class="credits flex flex-col gap-1">
        {
          credits.map(({ name, role }) => (
            <p class="font-open-sans leading-none">
              <span class="font-bold">{role} :</span>
              <span class="font-light">{name}</span>
            </p>
          ))
        }
      </div>
    </div>
  </div>
  <!-- üîó Links -->
  <ul
    class="flex items-center justify-center gap-4 font-bakbak bg-black py-1 text-yellow lg:py-2 lg:text-lg">
    {
      links.map(({ name, url }) => (
        <a
          href={url}
          class="useful-link  relative before:absolute before:bottom-0 before:left-1/2 before:block before:h-[2px] before:w-[0] before:translate-x-[-50%] before:bg-yellow before:transition-all before:content-[''] before:hover:w-full">
          <li>{name}</li>
        </a>
      ))
    }
  </ul>
</footer>
